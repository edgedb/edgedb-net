# -- Template --
# name: str                         | name of the test
# max_depth: int                    | max depth of the query
# ranges: [ str:range ]             | random generation min/max for each type
# default_range: range              | random generation min/max for all types without a specific range
# root_excluded: [ str ]            | excluded types for the root of the query
# excluded: [ str ]                 | excluded types for the query
# nested_excluded: [ str: [ str ] ] | excluded nested types within a type
# roll_nested: bool                 | roll nested type order (log(n))
# apply_range_to_sets: bool         | apply range rule to set generation: limits the number of sub-types within a type based off of the range
# seed: int                         | seed for random generation
#
# -- Default Values --
#
# name: null
# max_depth: 3
# ranges:
#  - array:            5..20         | number of elements
#  - bigint:           4..15         | magnitude in bytes
#  - bytes:           10..20         | num of bytes
#  - date_duration:     ..15         | power of (0.0..1.0) milliseconds: f(x) = rand(0,1)^range_rand(x)
#  - decimal:           ..100        | power of (0.0..1.0): f(x) = rand(0,1)^range_rand(x)
#  - duration:          ..500        | number of days
#  - float32:           ..100        | power of (0.0..1.0): f(x) = rand(0,1)^range_rand(x)
#  - float64:           ..100        | power of (0.0..1.0): f(x) = rand(0,1)^range_rand(x)
#  - int16:             ..32767      | random value within range
#  - int32:             ..2147483647 | random value within range
#  - relative_duration: ..100        | number of days
#  - str:             15..15         | number of characters
# default_range: 1..10
# root_excluded: []
# excluded: []
# nested_excluded: []
# roll_nested: false
# apply_range_to_sets: false
# seed: 0
groups:
  - name: V2 Arguments
    id: v2_arguments
    protocol: '1.0'
  - name: V2 Query Results
    id: v2_query_results
    protocol: '1.0'
  - name: V2 State
    id: v2_state
    protocol: '1.0'
rulesets:
  - group_id: v2_arguments
    name: Query Arguments
    test_name_template: Argument of type <$EDB_TYPE_NAME>
    excluded:
      - set
      - object
      - tuple
      - namedtuple
    nested_excluded:
      array:
        - array
    roll_nested: false
    query_templates:
      - query: SELECT <<$EDB_TYPE_NAME>>$arg
        arguments:
          arg: <$VALUE>
  - group_id: v2_query_results
    name: Query Results
    test_name_template: Query result of type <$EDB_TYPE_NAME>
    max_depth: 2
    nested_excluded:
      array:
        - array
        - set
        - object
      set:
        - object
    roll_nested: true
    apply_range_to_sets: true
    query_templates:
      - query: SELECT <$EDGEQL_VALUE>
  - group_id: v2_query_results
    name: Deep Query Nesting
    test_name_template: Deep query nesting of type <$EDB_TYPE_NAME>
    max_depth: 1
    excluded:
      - json
      - bigint
      - bool
      - bytes
      - date_duration
      - datetime
      - decimal
      - duration
      - float32
      - float64
      - int16
      - int32
      - local_datetime
      - local_date
      - relative_duration
      - uuid
    root_excluded:
      - str
      - int64
    nested_excluded:
      array:
        - array
        - set
        - object
    default_range: 2..2
    ranges:
      str: 15..15
    query_templates:
      - query: SELECT <$EDGEQL_VALUE>
  - group_id: v2_state
    name: Globals
    test_name_template: Global of type <$EDB_TYPE_NAME>
    max_depth: 3
    excluded:
      - object
      - namedtuple
      - set
    nested_excluded:
      array:
        - array
    query_templates:
      - name: Start transaction
        query: start transaction
        capabilities: Transaction
        cardinality: NoResult
        session:
          config:
            session_idle_transaction_timeout: '10:00:00'
            allow_bare_ddl: AlwaysAllow
      - name: Create global
        query: create global <$RAND_NAME_1> -> <$EDB_TYPE_NAME>
        capabilities: DDL
        cardinality: NoResult
        session:
          config:
            session_idle_transaction_timeout: '10:00:00'
            allow_bare_ddl: AlwaysAllow
      - name: Select global of type <$EDB_TYPE_NAME>
        query: select global <$RAND_NAME_1>
        session:
          globals:
            <$RAND_NAME_1>: <$VALUE>
          config:
            session_idle_transaction_timeout: '10:00:00'
            allow_bare_ddl: AlwaysAllow
      - name: Rollback
        query: rollback
        capabilities: Transaction
        cardinality: NoResult
        session:
          config:
            session_idle_transaction_timeout: '10:00:00'
            allow_bare_ddl: AlwaysAllow
